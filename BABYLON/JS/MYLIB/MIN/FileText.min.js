function DownloadText(filename,content){if(document.createElement("a").download!=null){var aLink=document.createElement("a");aLink.href="data:text/plain;charset=UTF-8,"+content;aLink.download=filename;var evt=document.createEvent("HTMLEvents");evt.initEvent("click",false,false);aLink.dispatchEvent(evt)}else{var Folder=BrowseFolder();if(Folder=="false"){alert("保存失败！")}else{var fso,tf;fso=new ActiveXObject("Scripting.FileSystemObject");tf=fso.CreateTextFile(Folder+filename+".txt",true,true);tf.write(content);tf.Close();alert("保存完毕！")}}}function BrowseFolder(){try{var Message="请选择保存文件夹";var Shell=new ActiveXObject("Shell.Application");var Folder=Shell.BrowseForFolder(0,Message,64,17);if(Folder!=null){Folder=Folder.items();Folder=Folder.item();Folder=Folder.Path;if(Folder.charAt(Folder.length-1)!="\\"){Folder=Folder+"\\"}return Folder}}catch(e){return"false";alert(e.message)}}function UploadText(filename,evt,recallfunc){if(typeof FileReader=="undefined"){var fso,f1,ts,s;var as=[];var ForReading=1;fso=new ActiveXObject("Scripting.FileSystemObject");if(fso!=null){ts=fso.OpenTextFile(filename,ForReading,false,-1);s="";while(!ts.atEndOfLine){as.push(ts.ReadLine())}s=as.join("");ts.Close();eval(recallfunc)}}else{var files=evt.target.files;var s="";for(var i=0,f;f=files[i];i++){var reader=new FileReader();reader.readAsText(f);reader.onload=function(e){s=[e.target.result].join("");eval(recallfunc)}}}}function MakeDateStr(){var dt=new Date();var str_date=dt.getFullYear()+""+(dt.getMonth()+1)+""+dt.getDate()+"_"+dt.getHours()+"_"+dt.getMinutes()+"_"+dt.getSeconds();return str_date}function MakeDateStr2(){var dt=new Date();var str_date=dt.getFullYear()+"年"+(dt.getMonth()+1)+"月"+dt.getDate()+"日"+dt.getHours()+":"+dt.getMinutes()+":"+dt.getSeconds();return str_date}function subDate(dt1,dt2){var days=(dt2.getTime()-dt1.getTime())/(86400000);return days}function MakeExcel2(str_title,arr_th,th_start,td_start,arr_td,row_start){var arr_thl=arr_th.length;var arr_tdl=arr_td.length;try{var xls=new ActiveXObject("Excel.Application")}catch(e){alert("要打印该表，您必须安装Excel电子表格软件，同时浏览器须使用“ActiveX 控件”，您的浏览器须允许执行控件。");return""}xls.visible=true;var xlBook=xls.Workbooks.Add;var xlsheet=xlBook.Worksheets(1);xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(1,arr_thl-th_start)).mergecells=true;xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(1,arr_thl-th_start)).value=str_title;xlsheet.Rows(1).RowHeight=25;xlsheet.Rows(1).Font.Size=14;xlsheet.Rows(1).Font.Name="黑体";for(var i=0;i<arr_thl;i++){xlsheet.Columns(i+1).NumberFormatLocal="@";xlsheet.Cells(2,i+1).Value=arr_th[i+th_start]}for(var i=row_start;i<arr_tdl;i++){var k=0;for(var j=0;j<arr_thl;j++){if(arr_td[2][j+td_start+k]=="str"){xlsheet.Cells(i-1,j+1).Value=arr_td[i][j+td_start+k]}else{if(arr_td[2][j+td_start+k]=="none"){j--;k++}else{if(arr_td[2][j+td_start+k][0]=="switch"){for(var a=1;a<arr_td[2][j+td_start+k].length;a++){if(arr_td[2][j+td_start+k][a][0]==arr_td[i][j+td_start+k]){xlsheet.Cells(i-1,j+1).Value=arr_td[2][j+td_start+k][a][1];break}else{if(a==arr_td[2][j+td_start+k].length-1){xlsheet.Cells(i-1,j+1).Value=arr_td[i][j+td_start+k]}}}}else{xlsheet.Cells(i-1,j+1).Value=arr_td[i][j+td_start+k]}}}}}xlsheet.Columns.AutoFit;xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).HorizontalAlignment=-4108;xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(1,arr_thl-th_start)).VerticalAlignment=-4108;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Font.Size=10;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(3).Weight=2;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(4).Weight=2;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(1).Weight=2;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(2).Weight=2;xls.UserControl=true;xls=null;xlBook=null;xlsheet=null}function HtmlTOExcel(str_title,id_tab,arr_thl,arr_tdl){try{var xls=new ActiveXObject("Excel.Application")}catch(e){alert("要打印该表，您必须安装Excel电子表格软件，同时浏览器须使用“ActiveX 控件”，您的浏览器须允许执行控件。");return""}xls.visible=true;var xlBook=xls.Workbooks.Add;var xlsheet=xlBook.Worksheets(1);xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(1,arr_thl)).mergecells=true;xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(1,arr_thl)).value=str_title;xlsheet.Rows(1).RowHeight=25;xlsheet.Rows(1).Font.Size=14;xlsheet.Rows(1).Font.Name="黑体";var datatab=document.getElementById("id_tab");for(var i=0;i<arr_tdl;i++){var tds=datatab.childNodes[0].childNodes[i].childNodes;for(var j=0;j<tds.length;j++){if(parseInt(tds[j].colSpan)>1){xlsheet.Range(xlsheet.Cells(i+2,j+1),xlsheet.Cells(i+2,j+parseInt(tds[j].colSpan))).mergecells=true;if(tds[j][0]){xlsheet.Range(xlsheet.Cells(i+2,j+1),xlsheet.Cells(i+2,j+parseInt(tds[j].colSpan))).value=j+=parseInt(tds[j].colSpan)-1}}}}xlsheet.Columns.AutoFit;xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).HorizontalAlignment=-4108;xlsheet.Range(xlsheet.Cells(1,1),xlsheet.Cells(1,arr_thl-th_start)).VerticalAlignment=-4108;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Font.Size=10;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(3).Weight=2;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(4).Weight=2;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(1).Weight=2;xlsheet.Range(xlsheet.Cells(2,1),xlsheet.Cells(arr_tdl-row_start+2,arr_thl-th_start)).Borders(2).Weight=2;xls.UserControl=true;xls=null;xlBook=null;xlsheet=null}function ImportXLSX(fileName){var arr_xlsx=[];var arr_temp=[];var objCon=new ActiveXObject("ADODB.Connection");objCon.Provider="Microsoft.ACE.OLEDB.12.0";objCon.ConnectionString="Data Source="+fileName+";Extended Properties=Excel 12.0;";objCon.CursorLocation=1;objCon.Open;var strQuery;var strSheetName="Sheet1$";var rsTemp=new ActiveXObject("ADODB.Recordset");rsTemp=objCon.OpenSchema(20);if(!rsTemp.EOF){strSheetName=rsTemp.Fields("Table_Name").Value}rsTemp=null;rsExcel=new ActiveXObject("ADODB.Recordset");strQuery="SELECT * FROM ["+strSheetName+"]";rsExcel.ActiveConnection=objCon;rsExcel.Open(strQuery);while(!rsExcel.EOF){arr_temp=[];for(i=0;i<rsExcel.Fields.Count;++i){var str_val=rsExcel.Fields(i).value!=null?rsExcel.Fields(i).value:"null";arr_temp.push(str_val)}arr_xlsx.push(arr_temp);rsExcel.MoveNext}objCon.Close;objCon=null;rsExcel=null;return arr_xlsx}var GB2312UnicodeConverter={ToUnicode:function(str){return escape(str).toLocaleLowerCase().replace(/%u/gi,"\\u")},ToGB2312:function(str){return unescape(str.replace(/\\u/gi,"%u"))}};